---
- name: Linux Patching
  hosts: all  
  become: true 
  become_user: root

  tasks:
  - name: Check for updates
    yum: update_cache=yes  # For RHEL/CentOS

  - name: Simulate a dry run of package installation
    yum: dry_run=yes  # For RHEL/CentOS

  - name: Install available updates
    yum: state=latest  # For RHEL/CentOS


  - name: Reboot required check (distribution specific)
    command: rpm -qa --last | grep kernel  # For RHEL/CentOS
    register: reboot_required  # Capture output in a variable
    when: ansible_distribution == 'RedHat' or ansible_distribution == 'CentOS'

  - name: Reboot the server (optional)
    reboot:
      post_reboot_delay: 300  # Wait 5 minutes after reboot
